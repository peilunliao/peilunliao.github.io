<!DOCTYPE html>
<html>
<head>
	<title>My game</title>
	<link rel="icon" href="../smile.gif" type="image/gif" sizes="16x16">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/css?family=Amatic+SC|Calligraffitti" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<script>
    var pic = document.getElementsByClassName('all');
    function main(){
      $('.all').hide();
      $('.all').fadeIn(900);
    }
    $(document).ready(main);
  	</script>

	<style>
	*{
		margin: 0;
		padding: 0;
	}
	body{
		background-color: #ffffcc;
		padding: 0;
		margin: 0;

	}
	canvas{
		position: absolute;
		top:90px;
		left: 33%;
		border: 1px solid #d3d3d3;
    	background-color: #f1f1f1;
    	
	}
	.all{
		position: relative;
		height: 600px;		
	}
	ul {
	  list-style-type: none;
	  margin: 0;
	  padding: 0;
	  overflow: hidden;
	  background-color: #333;

	}
	li {
	  float: left;
	}
	li a {
	  display:block;
	  color: white;
	  text-align: center;
	  padding: 18px 24px;
	  text-decoration: none;
	  font-family: "Courier New", "Arial Black", "Serif";

	}

	li a:hover {
	  background-color: #111;
	}
	.btnback{
		position: relative;
		left: 33%;
		width: 480px;
		height: 270px;
		margin: 40px 0;
	}

	#btn{
		position: absolute;
		top:42%;
		left: 36%;
    	cursor: pointer;
		
	}
	button:hover{
		background-color: #9999ff;
	}
	#startcon{
		position: absolute;
		top:40%;
		left: 38%;
    	cursor: pointer;

	}
	#back{
		position: absolute;
		
	}
	button{
		background-color: #6666ff;
		min-width: 50px;
    	border: none;
    	color: white;
    	padding: 15px 32px;
    	text-align: center;
    	font-size: 16px;
    	margin: 4px 2px;
    	cursor: pointer;
    	border-radius: 12px;
    	font-family: Courier, "Arial Black", "Serif";
	}
	#words{
		position: relative;
		height: 260px;
	}
	#words h2{
		position: absolute;
		left:40%;
		font-size: 60px;
		font-family: 'Amatic SC', cursive;
		
	}
	#words p{
		position: absolute;
		top:30%;
		left: 12%;
		font-size: 35px;
		font-family: 'Calligraffitti', cursive;
		text-align: center;
	}
	</style>
</head>
<body>
<div class="navBar">
  <ul>
    <li><a href="../mainpage/peilunliao.html">HOME</a></li>
    <li><a href="../quote/quote.html">QUOTES NOTING</a></li>
    <li><a href="../timer/timer.html">COUNTDOWN TIMER</a></li>
    <li><a href="../slideshow/slideshow.html">PHOTO SLIDESHOW</a></li>
    <li><a href="game.html">LITTLE SPACE GAME</a></li>
    <li><a href="../paint/paint.html">PAINTER</a></li>
  </ul>
</div>
<div class="all">
  <div class="btnback">
	<div id="back">
		<img id="pic" src="background.png">
	</div>
	<div id="startcon">	
		<button id="startbtn" onclick="beginning()">Start</button>
	</div>
	<div id="btn">
	
	</div>
  </div>
	<div id="words">
		<h2>Little Space Game</h2>
		<p>This is the little game I designed.Please hit the Start button to begin the game.<br>
			Use the keyboard arrow to avoid the red rocks randomly flying in the space.<br>
			Let's start the game and see how far you can go!! Hope you will enjoy it!!<br>
		</p>
	</div>
</div>
<script>
var myGamePiece;
var touchx  ;
var touchy ;	
var myBackground;
var myObstacles = [];
var myScore;
var btn ;
	function beginning(){
		var startbtn = document.getElementById("startbtn");
		var pic = document.getElementById("pic")
		document.getElementById("startcon").removeChild(startbtn);
		document.getElementById("back").removeChild(pic);
		startGame();
	}

	function startGame() {		
		myGamePiece = new component(30, 30, "smileogj.png", 10,120, "image");
		myScore = new component("20px", "Consolas", "yellow", 350, 40, "text");
		myBackground = new component(480,270,"background.png",0,0,"background")
		myGameArea.start();
	}

	var myGameArea = {
		canvas: document.createElement("canvas"),
		start : function(){
			this.canvas.width = 480;
			this.canvas.height = 270;
			this.context = this.canvas.getContext("2d");
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.frameNo = 0;
			this.interval = setInterval(updateGameArea, 20);
			window.addEventListener('touchmove', function (e) {
				e.preventDefault();
				
				touchx = e.touches[0].clientX ;
				touchy = e.touches[0].clientY ;	
				
               			
        	},false)

			window.addEventListener('keydown',function(e){
				myGameArea.keys = (myGameArea.keys || []);
				myGameArea.keys[e.keyCode] = true;
			})
			window.addEventListener('keyup',function(e){
				myGameArea.keys[e.keyCode] = false;
			})
		},
		clear : function(){
			this.context.clearRect(0,0,this.canvas.width, this.canvas.height);
		},
		stop : function(){
			clearInterval(this.interval);
		},
		restart : function(){
			this.btn = document.createElement("BUTTON");
			var textnode = document.createTextNode("Restart");
			this.btn.appendChild(textnode);
			document.getElementById("btn").appendChild(this.btn);
			
		},
		debtn : function(){
			document.getElementById("btn").removeChild(this.btn);
		}
		
	}

	function restart(){
		var rect = myGameArea.canvas.getBoundingClientRect();
		startGame();
		myObstacles = [];
		myGameArea.debtn();
		touchx = 10 + rect.x;
		touchy = 120 + rect.y;
	}

	function component(width, height, color, x, y, type){
		this.type = type;
		if(type == "image" || type == "background"){
			this.image = new Image();
			this.image.src = color;
		}
		this.width = width;
		this.height = height;
		this.speedX = 0;
		this.speedY = 0;
		this.x = x;
		this.y = y;
		this.update = function(){
			ctx = myGameArea.context;
			if(this.type == "text"){
			ctx.font = this.width + " " + this.height;
      		ctx.fillStyle = color;
      		ctx.fillText(this.text, this.x, this.y);
			}else if(type == "image" || type == "background"){
				ctx.drawImage(this.image,this.x,this.y,this.width,this.height);
				if(type == "background"){
					ctx.drawImage(this.image,this.x + this.width,this.y,this.width,this.height);
				}
			}else{
			ctx.fillStyle = color;
			ctx.fillRect(this.x, this.y, this.width, this.height);	
			}
		}	
		this.newPos = function(){
			 
			if(this.type == "image"){
				if(this.x < 0 || this.x == 0){
					this.x = 0;
					this.y += this.speedY;
				}else if(this.x > 450 || this.x == 450){
					this.x = 450;
					this.y += this.speedY;					
				}else if(this.y < 0 || this.y == 0){
					this.x += this.speedX;
					this.y = 0;
				}else if(this.y > 240 || this.y == 240){
					this.x += this.speedX;
					this.y = 240;
				}else{
				this.x += this.speedX;
				this.y += this.speedY;
				}
			}
			this.x += this.speedX;
			this.y += this.speedY;

			if(this.type == "background"){
				if(this.x == -(this.width)){
					this.x = 0 ;
				}
			}
		}	
		this.crashWith = function(otherobj) {
        	var myleft = this.x;
        	var myright = this.x + (this.width);
        	var mytop = this.y;
        	var mybottom = this.y + (this.height);
        	var otherleft = otherobj.x;
        	var otherright = otherobj.x + (otherobj.width);
        	var othertop = otherobj.y;
        	var otherbottom = otherobj.y + (otherobj.height);
        	var crash = true;
        	if ((mybottom < othertop) ||
               (mytop > otherbottom) ||
               (myright < otherleft) ||
               (myleft > otherright)) {
           crash = false;
        }
        return crash;
    }
}


	function updateGameArea(){
		var x, y, y1, y2, y3, y4, size1, size2, size3, size4,rect;
		
		
		for(i = 0; i< myObstacles.length; i += 1){
			if(myGamePiece.crashWith(myObstacles[i])){
				myGameArea.stop();
				myGameArea.restart();
				document.getElementById("btn").addEventListener("click", restart);	
				return;
			}
		}		
		myGameArea.clear();
		rect = myGameArea.canvas.getBoundingClientRect();
		if (touchx && touchy) {
        		myGamePiece.x = touchx - rect.left;
        		myGamePiece.y = touchy - rect.top; 
   		 }
		myBackground.speedX = -1;
		myBackground.newPos();
		myBackground.update();
		myGameArea.frameNo += 1;
		if(myGameArea.frameNo == 1 || everyinterval(100)){
			x = myGameArea.canvas.width;
			y1 = Math.random()*(100);
			y2 = Math.random()*(105);
			size1 = Math.random()* 30;
			size2 = Math.random()* 30;
			 
			
			myObstacles.push(new component(15 + size1, 15+size1, "red", x, y1));
			myObstacles.push(new component(10 + size2, 10+size2, "red", x, 135+y2));
			if(myGameArea.frameNo > 600 ){
				size3 = Math.random()*30;
				y3 = Math.random()*(50);
				size4 = Math.random()*30;
				y4 = Math.random()*(80);
				myObstacles.push(new component(15 + size3, 15+size3, "red", x, y3));
				myObstacles.push(new component(10 + size4, 10+size4, "red", x, 160+y4));
			}
		}

		for(i = 0; i < myObstacles.length; i+= 1){
			myObstacles[i].x += Math.random()*(-6);

			if( i % 4 == 1 && i != 1) {
				myObstacles[i].y += Math.random()*2 -1;

			}else if(i % 3 == 1 && i != 1){
				myObstacles[i].y -= Math.random()*2 -1;
			}else if(i % 2 == 0){
				myObstacles[i].y += Math.random()*(1);
			}else{
				myObstacles[i].y -= Math.random()*(1);
			}	
			myObstacles[i].update();
		  }
	   
		myGamePiece.speedX = 0;
    	        myGamePiece.speedY = 0;
		if(myGameArea.keys && myGameArea.keys[37]){myGamePiece.speedX = -1;}
		if(myGameArea.keys && myGameArea.keys[39]){myGamePiece.speedX = 1;}
		if(myGameArea.keys && myGameArea.keys[38]){myGamePiece.speedY = -1;}
		if(myGameArea.keys && myGameArea.keys[40]){myGamePiece.speedY = 1;}
		myScore.text="SCORE: " + myGameArea.frameNo;
		myScore.update();
		myGamePiece.newPos();
		myGamePiece.update();
		}
		function everyinterval(n) {
    	if ((myGameArea.frameNo / n) % 1 == 0) {return true;}
    	return false;
	}
</script>

</body>
</html>
